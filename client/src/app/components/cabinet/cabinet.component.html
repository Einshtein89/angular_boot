<div *ngIf="loading"><img class="spinner" src="assets/ajax-loader.gif"></div>
<div *ngIf="!loading">
  <br/>
<div>
  <h2 class="title" class="header-centered">{{ 'my.cabinet.title' | translate }}</h2>
</div>
  <br/>
    <form class="ui large equal width form segment" novalidate
          [formGroup]="myForm"
          (ngSubmit)="onSubmit(myForm.value)">
      <div class="two fields">
        <div class="field" [ngClass]="{
          'has-danger': firstName.invalid && (firstName.dirty || firstName.touched),
          'has-success': firstName.valid && (firstName.dirty || firstName.touched)
        }">
          <label #firstNameLabel for="firstName">{{ 'user.form.actions.first.name.label' | translate }}</label>
          <div class="unEditableField" *ngIf="!editableFields.get('firstName')"
            (mouseover)="editableFields.set('firstName', true)">
            {{ myForm.get('firstName').value }}
          </div>
          <input *ngIf="editableFields.get('firstName')"
                 (mouseout)="setFieldUneditable('firstName', firstName.errors)"
                 type="text"
                 id="firstName"
                 class="form-control"
                 formControlName="firstName"
                 placeholder="{{ firstNameLabel.innerHTML}}">
          <div class="error"
               *ngIf="firstName.errors && (firstName.dirty || firstName.touched)">
            <p *ngIf="firstName.errors.required">
              {{ 'field.error' | translate }}
              {{ firstNameLabel.innerHTML}}
              {{ 'required.error' | translate }}
            </p>
            <p *ngIf="firstName.errors.maxlength">
              {{ 'field.error' | translate }}
              {{ firstNameLabel.innerHTML}}
              {{ 'maxlength.error' | translate }}
              {{ firstName.errors.maxlength.requiredLength }}
            </p>
          </div>
        </div>
        <div class="field" [ngClass]="{
          'has-danger': lastName.invalid && (lastName.dirty || lastName.touched),
          'has-success': lastName.valid && (lastName.dirty || lastName.touched)
        }">
          <label #lastNameLabel for="lastName">{{ 'user.form.actions.last.name.label' | translate }}</label>
          <div class="unEditableField" *ngIf="!editableFields.get('lastName')"
               (mouseover)="editableFields.set('lastName', true)">
            {{ myForm.get('lastName').value }}
          </div>
          <input *ngIf="editableFields.get('lastName')"
                 (mouseout)="setFieldUneditable('lastName', lastName.errors)"
                 type="text"
                 id="lastName"
                 class="form-control"
                 formControlName="lastName"
                 placeholder="{{ lastNameLabel.innerHTML }}">
          <div class="error"
               *ngIf="lastName.errors && (lastName.dirty || lastName.touched)">
            <p *ngIf="lastName.errors.required">
              {{ 'field.error' | translate }}
              {{ lastNameLabel.innerHTML}}
              {{ 'required.error' | translate }}
            </p>
            <p *ngIf="lastName.errors.maxlength">
              {{ 'field.error' | translate }}
              {{ firstNameLabel.innerHTML}}
              {{ 'maxlength.error' | translate }}
              {{ lastName.errors.maxlength.requiredLength }}
            </p>
          </div>
        </div>
      </div>

      <div class="two fields">
        <div class="field" [ngClass]="{
          'has-danger': email.invalid && (email.dirty || email.touched),
          'has-success': email.valid && (email.dirty || email.touched)
        }">
          <label #emailLabel for="email">{{ 'user.form.actions.email.label' | translate }}</label>
          <div class="unEditableField" *ngIf="!editableFields.get('email')"
               (mouseover)="editableFields.set('email', true)">
            {{ myForm.get('email').value }}
          </div>
          <input *ngIf="editableFields.get('email')"
                 (mouseout)="setFieldUneditable('email', email.errors)"
                 type="text"
                 id="email"
                 class="form-control"
                 formControlName="email"
                 placeholder="{{ emailLabel.innerHTML}}">
          <div class="error"
               *ngIf="email.errors && (email.dirty || email.touched)">
            <p *ngIf="email.errors.required">
              {{ 'field.error' | translate }}
              {{ emailLabel.innerHTML}}
              {{ 'required.error' | translate }}
            </p>
            <p *ngIf="email.errors.email">{{ 'field.error' | translate }}
              {{ emailLabel.innerHTML}}
              {{ 'field.format.invalid.error' | translate }}
            </p>
          </div>
        </div>
        <div class="field" [ngClass]="{
          'has-danger': phone.invalid && (phone.dirty || phone.touched),
          'has-success': phone.valid && (phone.dirty || phone.touched)
        }">
          <label #phoneLabel for="phone">{{ 'user.form.actions.phone.label' | translate }}</label>
          <div class="unEditableField" *ngIf="!editableFields.get('phone')"
               (mouseover)="editableFields.set('phone', true)">
            {{ myForm.get('phone').value }}
          </div>
          <input *ngIf="editableFields.get('phone')"
                 (mouseout)="setFieldUneditable('phone', phone.errors)"
                 type="text"
                 id="phone"
                 class="form-control"
                 formControlName="phone"
                 placeholder="{{ phoneLabel.innerHTML}}">
          <div class="error"
               *ngIf="phone.errors && (phone.dirty || phone.touched)">
            <p *ngIf="phone.errors.required">
              {{ 'field.error' | translate }}
              {{ phoneLabel.innerHTML}}
              {{ 'required.error' | translate }}
            </p>
            <p *ngIf="phone.errors.pattern">
              {{ 'field.error' | translate }}
              {{ phoneLabel.innerHTML}}
              {{ 'field.format.invalid.error' | translate }}
            </p>
            <!--<p *ngIf="phone.errors.minlength">Password must be 8 characters long,-->
            <!--we need another {{ phone.errors.minlength.requiredLength - phone.errors.minlength.actualLength}} characters </p>-->
          </div>
        </div>
      </div>

      <div class="field" [ngClass]="{
        'has-danger': sex.invalid && (sex.dirty || sex.touched),
        'has-success': sex.valid && (sex.dirty || sex.touched)
      }">
        <label #sexLabel for="sex">{{ 'user.form.actions.sex.label' | translate }}</label>
        <div class="unEditableField" *ngIf="!editableFields.get('sex')"
             (mouseover)="editableFields.set('sex', true)">
          {{ getUneditableSexValue(myForm.get('sex').value) }}
        </div>
        <select *ngIf="editableFields.get('sex')"
                (mouseout)="setFieldUneditable('sex', sex.errors)"
                id="sex"
                class="form-control"
                formControlName="sex"
                value ="myForm.sex">
          <option *ngFor="let sex of sexArray" [value]="getKey(sex)">{{ getValue(sex) }}</option>
        </select>
        <div class="error"
             *ngIf="sex.errors && (sex.dirty || sex.touched)">
          <p *ngIf="sex.errors.required">
            {{ 'field.error' | translate }}
            {{ sexLabel.innerHTML}}
            {{ 'required.error' | translate }}
          </p>
        </div>
      </div>
      <div *ngIf="myForm.touched  && myForm.invalid"
           class="error">{{ 'fill.all.fields.note' | translate }}
      </div>
      <div class="error" *ngIf="errorList">
        <p *ngFor="let error of errorList">
          {{error}}
        </p>
      </div>
      <div class="modal-footer">
        <button (click)="goToPrevPage()"
                class="ui positive left floated button">{{ 'user.form.actions.back.button' | translate }}
        </button>
        <button type="submit" [disabled]="myForm.invalid"
                class="ui positive right floated button">{{ 'user.form.actions.submit.button' | translate }}
        </button>
      </div>
    </form>
</div>
